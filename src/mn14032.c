#include "mn14032.h"

#include "pins.h"
#include "utils.h"

#define MN14032_HEIGHT          32
#define MN14032_WIDTH           140

#define MN14032_COLS            24
#define MN14032_GRIDS           48
#define MN14032_GRID_BITS       6

static uint8_t fb[MN14032_HEIGHT * MN14032_COLS] = {
    // ████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
    // ███████████████████∙██∙█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
    // ███████████████████∙██∙█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
    // ██████████∙████∙██████████∙∙∙∙∙███∙████∙███∙∙∙∙███∙∙∙∙∙∙██████████∙████∙███∙∙∙∙███████████∙∙∙∙∙███∙∙∙∙∙∙█████∙∙∙███∙∙∙∙██∙█████∙████████████
    // ██████████∙████∙██∙∙∙∙∙∙██∙████∙██∙████∙██∙████∙██∙███████████████∙████∙██∙████∙██████████∙███████∙█████████∙██∙██∙████∙█∙∙███∙∙████████████
    // ██████████∙████∙██∙███████∙████∙██∙████∙██∙████∙██∙███████████████∙████∙██∙████∙██████████∙███████∙████████∙███∙██∙████∙█∙█∙█∙█∙████████████
    // ██████████∙████∙██∙███████∙████∙██∙████∙██∙████∙██∙███████████████∙████∙██∙████∙██████████∙∙∙∙∙███∙████████∙███∙██∙████∙█∙██∙██∙████████████
    // ██████████∙████∙██∙███████∙████∙██∙∙∙∙∙∙██∙████∙██∙∙∙∙████████████∙∙∙∙∙∙██∙████∙██████████∙████∙██∙∙∙∙█████∙███∙██∙████∙█∙██∙██∙████████████
    // ███████████∙∙∙∙∙██∙∙∙∙████∙∙∙∙∙███∙████∙██∙████∙██∙███████████████∙████∙██∙∙∙∙∙∙██████████∙████∙██∙████████∙███∙██∙████∙█∙█████∙████████████
    // ███████████████∙██∙███████∙███████∙████∙██∙████∙██∙███████████████∙████∙██∙████∙██████████∙████∙██∙████████∙███∙██∙████∙█∙█████∙████████████
    // ███████████████∙██∙███████∙███████∙████∙██∙████∙██∙███████████████∙████∙██∙████∙██████████∙████∙██∙████████∙███∙██∙████∙█∙█████∙████████████
    // ███████████████∙██∙███████∙███████∙████∙██∙████∙██∙███████████████∙████∙██∙████∙██████████∙████∙██∙████████∙███∙██∙████∙█∙█████∙████████████
    // ███████████████∙██∙∙∙∙∙∙██∙███████∙████∙███∙∙∙∙███∙∙∙∙∙∙██████████∙████∙██∙████∙██████████∙∙∙∙∙███∙∙∙∙∙∙██∙████∙███∙∙∙∙██∙█████∙████████████
    // ████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
    // ████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
    // ████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
    // ∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙
    // ∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙█∙∙█∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙
    // ∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙█∙∙█∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙
    // ∙∙∙∙∙∙∙∙∙∙█████∙∙∙██████∙∙∙∙∙███∙∙∙████∙∙∙██████∙∙∙∙∙∙∙∙∙∙█∙∙∙∙█∙∙∙████∙∙∙∙∙∙∙∙∙∙∙█∙∙∙∙█∙∙∙∙∙∙∙∙∙∙█████∙∙∙█∙∙∙∙█∙∙∙████∙∙█∙∙∙∙∙█∙∙∙∙∙∙∙∙∙∙∙∙
    // ∙∙∙∙∙∙∙∙∙∙█∙∙∙∙∙∙∙█∙∙∙∙∙∙∙∙∙█∙∙█∙∙█∙∙∙∙█∙∙█∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙█∙∙∙∙█∙∙█∙∙∙∙█∙∙∙∙∙∙∙∙∙∙█∙∙∙∙█∙∙██████∙∙█∙∙∙∙█∙∙█∙∙∙∙█∙∙█∙∙∙∙█∙██∙∙∙██∙∙∙∙∙∙∙∙∙∙∙∙
    // ∙∙∙∙∙∙∙∙∙∙█∙∙∙∙∙∙∙█∙∙∙∙∙∙∙∙█∙∙∙█∙∙█∙∙∙∙█∙∙█∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙█∙∙∙∙█∙∙█∙∙∙∙█∙∙∙∙∙∙∙∙∙∙█∙∙∙∙█∙∙█∙∙∙∙∙∙∙█∙∙∙∙█∙∙█∙∙∙∙█∙∙█∙∙∙∙█∙█∙█∙█∙█∙∙∙∙∙∙∙∙∙∙∙∙
    // ∙∙∙∙∙∙∙∙∙∙█████∙∙∙█∙∙∙∙∙∙∙∙█∙∙∙█∙∙█∙∙∙∙█∙∙█∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙█∙∙∙∙█∙∙█∙∙∙∙█∙∙∙∙∙∙∙∙∙∙█∙∙∙∙█∙∙█∙∙∙∙∙∙∙█∙∙∙∙█∙∙█∙∙∙∙█∙∙█∙∙∙∙█∙█∙∙█∙∙█∙∙∙∙∙∙∙∙∙∙∙∙
    // ∙∙∙∙∙∙∙∙∙∙█∙∙∙∙█∙∙████∙∙∙∙∙█∙∙∙█∙∙█∙∙∙∙█∙∙████∙∙∙∙∙∙∙∙∙∙∙∙██████∙∙█∙∙∙∙█∙∙∙∙∙∙∙∙∙∙█∙∙∙∙█∙∙█∙∙∙∙∙∙∙█∙∙∙∙█∙∙██████∙∙█∙∙∙∙█∙█∙∙█∙∙█∙∙∙∙∙∙∙∙∙∙∙∙
    // ∙∙∙∙∙∙∙∙∙∙█∙∙∙∙█∙∙█∙∙∙∙∙∙∙∙█∙∙∙█∙∙█∙∙∙∙█∙∙█∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙█∙∙∙∙█∙∙██████∙∙∙∙∙∙∙∙∙∙∙█████∙∙████∙∙∙∙█████∙∙∙█∙∙∙∙█∙∙█∙∙∙∙█∙█∙∙∙∙∙█∙∙∙∙∙∙∙∙∙∙∙∙
    // ∙∙∙∙∙∙∙∙∙∙█∙∙∙∙█∙∙█∙∙∙∙∙∙∙∙█∙∙∙█∙∙█∙∙∙∙█∙∙█∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙█∙∙∙∙█∙∙█∙∙∙∙█∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙█∙∙█∙∙∙∙∙∙∙█∙∙∙∙∙∙∙█∙∙∙∙█∙∙█∙∙∙∙█∙█∙∙∙∙∙█∙∙∙∙∙∙∙∙∙∙∙∙
    // ∙∙∙∙∙∙∙∙∙∙█∙∙∙∙█∙∙█∙∙∙∙∙∙∙∙█∙∙∙█∙∙█∙∙∙∙█∙∙█∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙█∙∙∙∙█∙∙█∙∙∙∙█∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙█∙∙█∙∙∙∙∙∙∙█∙∙∙∙∙∙∙█∙∙∙∙█∙∙█∙∙∙∙█∙█∙∙∙∙∙█∙∙∙∙∙∙∙∙∙∙∙∙
    // ∙∙∙∙∙∙∙∙∙∙█∙∙∙∙█∙∙█∙∙∙∙∙∙∙∙█∙∙∙█∙∙█∙∙∙∙█∙∙█∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙█∙∙∙∙█∙∙█∙∙∙∙█∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙█∙∙█∙∙∙∙∙∙∙█∙∙∙∙∙∙∙█∙∙∙∙█∙∙█∙∙∙∙█∙█∙∙∙∙∙█∙∙∙∙∙∙∙∙∙∙∙∙
    // ∙∙∙∙∙∙∙∙∙∙█████∙∙∙██████∙∙█∙∙∙∙█∙∙∙████∙∙∙██████∙∙∙∙∙∙∙∙∙∙█∙∙∙∙█∙∙█∙∙∙∙█∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙█∙∙██████∙∙█∙∙∙∙∙∙∙█∙∙∙∙█∙∙∙████∙∙█∙∙∙∙∙█∙∙∙∙∙∙∙∙∙∙∙∙
    // ∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙
    // ∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙
    // ∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙∙
    0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x30,
    0x3f, 0x3f, 0x3f, 0x2d, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x30,
    0x3f, 0x3f, 0x3f, 0x2d, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x30,
    0x3f, 0x3d, 0x3b, 0x3f, 0x30, 0x1d, 0x3b, 0x21, 0x30, 0x0f, 0x3f, 0x1e, 0x38, 0x1f, 0x3f, 0x01, 0x30, 0x0f, 0x23, 0x21, 0x2f, 0x2f, 0x3f, 0x30,
    0x3f, 0x3d, 0x3b, 0x00, 0x37, 0x2d, 0x3b, 0x1e, 0x37, 0x3f, 0x3f, 0x1e, 0x37, 0x2f, 0x3f, 0x1f, 0x37, 0x3f, 0x1b, 0x1e, 0x27, 0x0f, 0x3f, 0x30,
    0x3f, 0x3d, 0x3b, 0x1f, 0x37, 0x2d, 0x3b, 0x1e, 0x37, 0x3f, 0x3f, 0x1e, 0x37, 0x2f, 0x3f, 0x1f, 0x37, 0x3e, 0x3b, 0x1e, 0x2a, 0x2f, 0x3f, 0x30,
    0x3f, 0x3d, 0x3b, 0x1f, 0x37, 0x2d, 0x3b, 0x1e, 0x37, 0x3f, 0x3f, 0x1e, 0x37, 0x2f, 0x3f, 0x01, 0x37, 0x3e, 0x3b, 0x1e, 0x2d, 0x2f, 0x3f, 0x30,
    0x3f, 0x3d, 0x3b, 0x1f, 0x37, 0x2c, 0x03, 0x1e, 0x30, 0x3f, 0x3f, 0x00, 0x37, 0x2f, 0x3f, 0x1e, 0x30, 0x3e, 0x3b, 0x1e, 0x2d, 0x2f, 0x3f, 0x30,
    0x3f, 0x3e, 0x03, 0x03, 0x30, 0x1d, 0x3b, 0x1e, 0x37, 0x3f, 0x3f, 0x1e, 0x30, 0x0f, 0x3f, 0x1e, 0x37, 0x3e, 0x3b, 0x1e, 0x2f, 0x2f, 0x3f, 0x30,
    0x3f, 0x3f, 0x3b, 0x1f, 0x37, 0x3d, 0x3b, 0x1e, 0x37, 0x3f, 0x3f, 0x1e, 0x37, 0x2f, 0x3f, 0x1e, 0x37, 0x3e, 0x3b, 0x1e, 0x2f, 0x2f, 0x3f, 0x30,
    0x3f, 0x3f, 0x3b, 0x1f, 0x37, 0x3d, 0x3b, 0x1e, 0x37, 0x3f, 0x3f, 0x1e, 0x37, 0x2f, 0x3f, 0x1e, 0x37, 0x3e, 0x3b, 0x1e, 0x2f, 0x2f, 0x3f, 0x30,
    0x3f, 0x3f, 0x3b, 0x1f, 0x37, 0x3d, 0x3b, 0x1e, 0x37, 0x3f, 0x3f, 0x1e, 0x37, 0x2f, 0x3f, 0x1e, 0x37, 0x3e, 0x3b, 0x1e, 0x2f, 0x2f, 0x3f, 0x30,
    0x3f, 0x3f, 0x3b, 0x00, 0x37, 0x3d, 0x3b, 0x21, 0x30, 0x0f, 0x3f, 0x1e, 0x37, 0x2f, 0x3f, 0x01, 0x30, 0x0d, 0x3b, 0x21, 0x2f, 0x2f, 0x3f, 0x30,
    0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x30,
    0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x30,
    0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x30,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x03, 0x38, 0x3f, 0x01, 0x31, 0x38, 0x3f, 0x00, 0x02, 0x04, 0x1e, 0x00, 0x02, 0x04, 0x00, 0x0f, 0x22, 0x04, 0x1e, 0x10, 0x10, 0x00, 0x00,
    0x00, 0x02, 0x00, 0x20, 0x02, 0x12, 0x04, 0x20, 0x00, 0x02, 0x04, 0x21, 0x00, 0x02, 0x04, 0x3f, 0x08, 0x12, 0x04, 0x21, 0x18, 0x30, 0x00, 0x00,
    0x00, 0x02, 0x00, 0x20, 0x04, 0x12, 0x04, 0x20, 0x00, 0x02, 0x04, 0x21, 0x00, 0x02, 0x04, 0x20, 0x08, 0x12, 0x04, 0x21, 0x15, 0x10, 0x00, 0x00,
    0x00, 0x03, 0x38, 0x20, 0x04, 0x12, 0x04, 0x20, 0x00, 0x02, 0x04, 0x21, 0x00, 0x02, 0x04, 0x20, 0x08, 0x12, 0x04, 0x21, 0x12, 0x10, 0x00, 0x00,
    0x00, 0x02, 0x04, 0x3c, 0x04, 0x12, 0x04, 0x3c, 0x00, 0x03, 0x3c, 0x21, 0x00, 0x02, 0x04, 0x20, 0x08, 0x13, 0x3c, 0x21, 0x12, 0x10, 0x00, 0x00,
    0x00, 0x02, 0x04, 0x20, 0x04, 0x12, 0x04, 0x20, 0x00, 0x02, 0x04, 0x3f, 0x00, 0x01, 0x3c, 0x3c, 0x0f, 0x22, 0x04, 0x21, 0x10, 0x10, 0x00, 0x00,
    0x00, 0x02, 0x04, 0x20, 0x04, 0x12, 0x04, 0x20, 0x00, 0x02, 0x04, 0x21, 0x00, 0x00, 0x04, 0x20, 0x08, 0x02, 0x04, 0x21, 0x10, 0x10, 0x00, 0x00,
    0x00, 0x02, 0x04, 0x20, 0x04, 0x12, 0x04, 0x20, 0x00, 0x02, 0x04, 0x21, 0x00, 0x00, 0x04, 0x20, 0x08, 0x02, 0x04, 0x21, 0x10, 0x10, 0x00, 0x00,
    0x00, 0x02, 0x04, 0x20, 0x04, 0x12, 0x04, 0x20, 0x00, 0x02, 0x04, 0x21, 0x00, 0x00, 0x04, 0x20, 0x08, 0x02, 0x04, 0x21, 0x10, 0x10, 0x00, 0x00,
    0x00, 0x03, 0x38, 0x3f, 0x08, 0x11, 0x38, 0x3f, 0x00, 0x02, 0x04, 0x21, 0x00, 0x00, 0x04, 0x3f, 0x08, 0x02, 0x04, 0x1e, 0x10, 0x10, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};


static void mn14032PinsInit(void)
{
    LL_GPIO_InitTypeDef initDef;

    initDef.Mode = LL_GPIO_MODE_OUTPUT;
    initDef.Speed = LL_GPIO_SPEED_FREQ_HIGH;
    initDef.OutputType = LL_GPIO_OUTPUT_PUSHPULL;

    initDef.Pin = MN14032_GCP_Pin;
    LL_GPIO_Init(MN14032_GCP_Port, &initDef);
    SET(MN14032_GCP);

    initDef.Pin = MN14032_BLK_Pin;
    LL_GPIO_Init(MN14032_BLK_Port, &initDef);
    SET(MN14032_BLK);

    initDef.Pin = MN14032_LAT_Pin;
    LL_GPIO_Init(MN14032_LAT_Port, &initDef);
    SET(MN14032_LAT);

    initDef.Pin = MN14032_CLK_Pin;
    LL_GPIO_Init(MN14032_CLK_Port, &initDef);
    SET(MN14032_CLK);

    initDef.Pin = MN14032_SIN_Pin;
    LL_GPIO_Init(MN14032_SIN_Port, &initDef);
    SET(MN14032_SIN);
}

void mn14032Init(void)
{
    mn14032PinsInit();

    CLR(MN14032_GCP);
}

void mn14032Test()
{
    static uint8_t row = 1;

    CLR(MN14032_LAT);
    CLR(MN14032_BLK);

    uint8_t prow = row - 1;

    for (int j = 0; j < MN14032_HEIGHT * MN14032_GRID_BITS; j++) {
        static const uint8_t idx[MN14032_GRID_BITS] = {0x20, 0x01, 0x10, 0x02, 0x08, 0x04};

        uint8_t odd = ((prow + j) % 2 == 0);
        uint8_t data = fb[j / MN14032_GRID_BITS * MN14032_COLS + prow / 2];

        if (odd && (data & idx[j % MN14032_GRID_BITS])) {
            SET(MN14032_SIN);
        } else {
            CLR(MN14032_SIN);
        }
        CLR(MN14032_CLK);
        SET(MN14032_CLK);
    }

    for (int i = 0; i < MN14032_GRIDS; i++) {
        CLR(MN14032_CLK);
        if (i == row || i == prow) {
            SET(MN14032_SIN);
        } else {
            CLR(MN14032_SIN);
        }
        SET(MN14032_CLK);
    }

    SET(MN14032_BLK);
    SET(MN14032_LAT);

    if (++row >= MN14032_GRIDS) {
        row = 1 ;
    }
}
